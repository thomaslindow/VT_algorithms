<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VT Algorithm Interactive Application</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f4f6f8;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            padding: 40px;
        }

        .algorithm-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .algorithm-card {
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .algorithm-card:hover {
            border-color: #3498db;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .algorithm-card.selected {
            border-color: #2ecc71;
            background: #e8f5e8;
        }

        .algorithm-card h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1.3em;
        }

        .algorithm-card .stats {
            font-size: 0.9em;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .algorithm-card .description {
            font-size: 0.9em;
            color: #2c3e50;
            line-height: 1.4;
        }

        .algorithm-interface {
            display: none;
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
        }

        .algorithm-interface.active {
            display: block;
        }

        .step-header {
            background: #f8f9fa;
            color: #2c3e50;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
        }

        .step-header h2 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1.8em;
        }

        .step-info {
            color: #2c3e50;
            font-size: 1.1em;
            margin: 0;
        }

        .step-content {
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .question {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .criteria {
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .criteria h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .criteria ul {
            color: #2c3e50;
            margin: 0;
            padding-left: 20px;
        }

        .criteria li {
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .btn-yes {
            background: #f8f9fa;
            color: #2c3e50;
            border: 3px solid #e9ecef;
        }

        .btn-yes:hover {
            background: #e9ecef;
            border-color: #2c3e50;
            transform: translateY(-2px);
        }

        .btn-no {
            background: #f8f9fa;
            color: #2c3e50;
            border: 3px solid #e9ecef;
        }

        .btn-no:hover {
            background: #e9ecef;
            border-color: #2c3e50;
            transform: translateY(-2px);
        }

        .btn-skip {
            background: #f8f9fa;
            color: #2c3e50;
            border: 3px solid #e9ecef;
        }

        .btn-skip:hover {
            background: #e9ecef;
            border-color: #2c3e50;
            transform: translateY(-2px);
        }

        .btn-back {
            background: #95a5a6;
            color: white;
        }

        .btn-back:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .result {
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            color: #2c3e50;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-top: 25px;
        }

        .result.vt {
            background: #f8f9fa;
            border-color: #e74c3c;
        }

        .result.svt {
            background: #f8f9fa;
            border-color: #2ecc71;
        }

        .result.pxt {
            background: #f8f9fa;
            border-color: #f39c12;
        }

        .result h2 {
            margin: 0 0 15px 0;
            font-size: 2.5em;
            color: #2c3e50;
        }

        .result p {
            margin: 0;
            font-size: 1.2em;
            color: #2c3e50;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
        }

        .progress {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: #2c3e50;
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .algorithm-selection {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VT Algorithm Navigator</h1>
            <p>Interactive tool for wide complex tachycardia differential diagnosis</p>
        </div>

        <div class="main-content">
            <div id="algorithmSelection" class="algorithm-selection">
                <div class="algorithm-card" onclick="selectAlgorithm('brugada')">
                    <h3>Brugada Algorithm</h3>
                    <div class="stats">Sensitivity: 89% | Specificity: 59%</div>
                    <div class="description">4-step sequential approach with comprehensive morphology analysis</div>
                </div>

                <div class="algorithm-card" onclick="selectAlgorithm('rwpt')">
                    <h3>RWPT Criterion</h3>
                    <div class="stats">Sensitivity: 60% | Specificity: 83%</div>
                    <div class="description">Single-measurement approach using R-wave peak time in lead II</div>
                </div>

                <div class="algorithm-card" onclick="selectAlgorithm('griffith')">
                    <h3>Griffith Algorithm</h3>
                    <div class="stats">Sensitivity: 94% | Specificity: 40%</div>
                    <div class="description">VT as default diagnosis unless proven SVT</div>
                </div>

                <div class="algorithm-card" onclick="selectAlgorithm('modified_brugada')">
                    <h3>Modified Brugada Algorithm</h3>
                    <div class="stats">Sensitivity: 92% | Specificity: 85%</div>
                    <div class="description">Differentiates VT from pre-excited tachycardia using 4-step approach</div>
                </div>
            </div>

            <!-- Brugada Algorithm Interface -->
            <div id="brugada" class="algorithm-interface">
                <div class="step-header">
                    <h2>Brugada Algorithm</h2>
                    <div class="step-info">Step <span id="brugada-step">1</span> of 4</div>
                </div>
                <div class="progress">
                    <div class="progress-bar" id="brugada-progress" style="width: 25%"></div>
                </div>
                <div id="brugada-content" class="step-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>

            <!-- RWPT Algorithm Interface -->
            <div id="rwpt" class="algorithm-interface">
                <div class="step-header">
                    <h2>R-Wave Peak Time Criterion</h2>
                    <div class="step-info">Single Step Analysis</div>
                </div>
                <div class="progress">
                    <div class="progress-bar" style="width: 100%"></div>
                </div>
                <div id="rwpt-content" class="step-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>

            <!-- Vereckei Algorithm Interface -->
            <div id="vereckei" class="algorithm-interface">
                <div class="step-header">
                    <h2>Vereckei aVR Algorithm</h2>
                    <div class="step-info">Step <span id="vereckei-step">1</span> of 4</div>
                </div>
                <div class="progress">
                    <div class="progress-bar" id="vereckei-progress" style="width: 25%"></div>
                </div>
                <div id="vereckei-content" class="step-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>

            <!-- Griffith Algorithm Interface -->
            <div id="griffith" class="algorithm-interface">
                <div class="step-header">
                    <h2>Griffith Algorithm</h2>
                    <div class="step-info">Step <span id="griffith-step">1</span> of 2</div>
                </div>
                <div class="progress">
                    <div class="progress-bar" id="griffith-progress" style="width: 50%"></div>
                </div>
                <div id="griffith-content" class="step-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
            <!-- Modified Brugada Algorithm Interface -->
            <div id="modified_brugada" class="algorithm-interface">
                <div class="step-header">
                    <h2>Modified Brugada Algorithm</h2>
                    <div class="step-info">Step <span id="modified_brugada-step">1</span> of 4</div>
                </div>
                <div class="progress">
                    <div class="progress-bar" id="modified_brugada-progress" style="width: 25%"></div>
                </div>
                <div id="modified_brugada-content" class="step-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Algorithm data and step definitions
        const algorithms = {
            brugada: {
                name: "Brugada Algorithm",
                reference: "Brugada P, Brugada J, Mont L, Smeets J, Andries EW. A new approach to the differential diagnosis of a regular tachycardia with a wide QRS complex. Circulation. 1991 May;83(5):1649-59",
                totalSteps: 4,
                currentStep: 1,
                steps: [
                    {
                        question: "Is positive or negative concordance (no rS complexes) present throughout all chest leads (V1-V6)?",
                        criteria: [
                            "Look for complete concordance in precordial leads",
                            "All positive R complexes OR all negative QS complexes"
                        ],
                        yesResult: "VT",
                        noResult: "continue"
                    },
                    {
                        question: "Does the RS interval exceed 100 ms in any of the chest leads?",
                        criteria: [
                            "Measure from R-wave onset to S-wave nadir"
                        ],
                        yesResult: "VT",
                        noResult: "continue"
                    },
                    {
                        question: "Is there evidence of AV dissociation?",
                        criteria: [
                            "P and QRS complexes at different rates",
                            "P waves often superimposed on QRS complexes",
                            "Check for capture and fusion beats"
                        ],
                        yesResult: "VT",
                        noResult: "continue"
                    },
                    {
                        question: "Does QRS morphology suggest VT?",
                        criteria: [
                            "<strong><em>RBBB-like morphology</em></strong> (Dominant R wave in V1):",
                            "&nbsp;&nbsp;&nbsp;<strong>V1/V2:</strong> Smooth monophasic R wave, Notched downslope to the R wave — the taller left rabbit ear, A qR complex (small Q wave, tall R wave) in V1",
                            "&nbsp;&nbsp;&nbsp;<strong>V6:</strong> QS complex, R/S ratio < 1 if left axis deviation is present",
                            "<strong><em>LBBB-like morphology</em></strong> (Dominant S wave in V1):",
                            "&nbsp;&nbsp;&nbsp;<strong>V1/V2:</strong> Initial R wave > 30-40 ms, Notching or slurring of the S wave (Josephson sign), RS interval (time from R wave onset to S wave nadir) > 60-70 ms",
                            "&nbsp;&nbsp;&nbsp;<strong>V6:</strong> QS complex (very specific), qR complex, SVT with LBBB is associated with absent Q waves in V6"
                        ],
                        yesResult: "VT",
                        noResult: "continue"
                    }
                ]
            },
            rwpt: {
                name: "R-Wave Peak Time Criterion",
                reference: "Pava LF, Parafán P, Badiel M, et al. R-wave peak time at DII: a new criterion to differentiate between wide complex QRS tachycardias. Heart Rhythm. 2010;7:922–6. doi: 10.1016/j.hrthm.2010.03.001",
                totalSteps: 1,
                currentStep: 1,
                steps: [
                    {
                        question: "Is the R-Wave Peak Time ≥50ms in Lead II?",
                        criteria: [
                            "From QRS onset to R peak or nadir Q"
                        ],
                        yesResult: "VT",
                        noResult: "SVT"
                    }
                ]
            },
            griffith: {
                name: "Griffith Algorithm",
                reference: "Griffith MJ, Garratt CJ, Mounsey P, Camm AJ. Ventricular tachycardia as default diagnosis in broad complex tachycardia. Lancet. 1994 Feb 12;343(8894):386-8. doi: 10.1016/s0140-6736(94)91223-8",
                totalSteps: 2,
                currentStep: 1,
                steps: [
                    {
                        question: "Is there AV dissociation?",
                        criteria: [
                            "P and QRS complexes at different rates",
                            "P waves are often superimposed on QRS complexes",
                            "Check for capture and fusion beats"
                        ],
                        yesResult: "VT",
                        noResult: "continue"
                    },
                    {
                        question: "Does the QRS match typical bundle branch block pattern?",
                        criteria: [
                            "For LBBB: rS/QS in V1&V2, S-nadir <70ms, R in V6",
                            "For RBBB: rSR' in V1, RS in V6, R>S in V6",
                            "ALL criteria must be met for SVT diagnosis",
                            "If criteria not met → VT"
                        ],
                        yesResult: "SVT",
                        noResult: "VT"
                    }
                ]
            },
            modified_brugada: {
                name: "Modified Brugada Algorithm",
                reference: "Vereckei A, Simon A, Szénási G, Miller JM. The Application of a New, Modified Algorithm for the Differentiation of Regular Ventricular and Pre-Excited Tachycardias. Heart Lung Circ. 2023 Jun;32(6):719-725. doi: 10.1016/j.hlc.2023.03.016",
                totalSteps: 4,
                currentStep: 1,
                steps: [
                    {
                        question: "Is there evidence of AV dissociation?",
                        criteria: [
                            "P and QRS complexes at different rates",
                            "P waves are often superimposed on QRS complexes",
                            "Check for capture and fusion beats"
                        ],
                        yesResult: "VT",
                        noResult: "continue"
                    },
                    {
                        question: "Is the onset of the QRS complex in aVR positive, AND the area above the baseline of the QRS complex greater than the area below the baseline?",
                        criteria: [
                            "In Cabrera lead system: Is the onset of the QRS complex in -aVR negative, AND the area below the baseline of the QRS greater than the area above the baseline",
                            "In PXT using a left posterior pathway, a predominantly positive QRS in aVR (negative in -aVR) can occur but positive initial R waves (q waves in -aVR) are rare"
                        ],
                        yesResult: "VT",
                        noResult: "continue"
                    },
                    {
                        question: "Is there a QR complex in one or more of leads V2-V6?",
                        criteria: [

                            "QR pattern suggests ventricular origin"
                        ],
                        yesResult: "VT",
                        noResult: "continue"
                    },
                    {
                        question: "Are there predominantly negative QRS complexes in leads V4-V6?",
                        criteria: [
                            "Preexcited SVT occurs through an accessory pathway at the base of the ventricles with a resulting vector directed towards the apex",
                            "Ventricular activation from apex to base indicates VT",
                            "If no criteria are fulfilled → Pre-excited tachycardia",
                            "If any of the criteria are fulfilled → VT"
                        ],
                        yesResult: "VT",
                        noResult: "Pre-excited SVT"
                    }
                ]
            }
        };

        let currentAlgorithm = null;
        let skippedSteps = [];
        let yesAnswers = []; // Track which steps had "Yes" answers

        function selectAlgorithm(algorithmName) {
            // Check if algorithm exists
            if (!algorithms[algorithmName]) {
                console.error('Algorithm not found:', algorithmName);
                return;
            }

            // Hide all algorithm interfaces
            document.querySelectorAll('.algorithm-interface').forEach(el => {
                el.classList.remove('active');
            });

            // Remove selection from all cards
            document.querySelectorAll('.algorithm-card').forEach(el => {
                el.classList.remove('selected');
            });

            // Select the clicked card
            event.target.closest('.algorithm-card').classList.add('selected');

            // Show selected algorithm interface
            const algorithmInterface = document.getElementById(algorithmName);
            if (algorithmInterface) {
                algorithmInterface.classList.add('active');
            } else {
                console.error('Algorithm interface not found:', algorithmName);
                return;
            }

            // Initialize the algorithm
            currentAlgorithm = algorithmName;
            algorithms[algorithmName].currentStep = 1;
            skippedSteps = [];
            yesAnswers = []; // Reset yes answers tracking
            
            loadStep();
        }

        function loadStep() {
            if (!currentAlgorithm || !algorithms[currentAlgorithm]) {
                console.error('Invalid algorithm:', currentAlgorithm);
                return;
            }

            const algo = algorithms[currentAlgorithm];
            const step = algo.steps[algo.currentStep - 1];
            const contentDiv = document.getElementById(currentAlgorithm + '-content');

            if (!contentDiv) {
                console.error('Content div not found for algorithm:', currentAlgorithm);
                return;
            }

            // Update step counter and progress
            const stepSpan = document.getElementById(currentAlgorithm + '-step');
            const progressBar = document.getElementById(currentAlgorithm + '-progress');
            
            if (stepSpan) stepSpan.textContent = algo.currentStep;
            if (progressBar) {
                const progress = (algo.currentStep / algo.totalSteps) * 100;
                progressBar.style.width = progress + '%';
            }

            // Create step content
            let criteriaHTML = '';
            step.criteria.forEach(criterion => {
                criteriaHTML += `<li>${criterion}</li>`;
            });

            let imageHTML = '';
            if (step.hasImage && step.imageData) {
                imageHTML = `
                    <div style="text-align: center; margin: 20px 0;">
                        <img src="${step.imageData}" alt="ECG Measurement Diagram" style="max-width: 100%; height: auto; border: 2px solid #e9ecef; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    </div>
                `;
            }

            contentDiv.innerHTML = `
                <div class="question">${step.question}</div>
                <div class="criteria">
                    <h4>Evaluation Criteria:</h4>
                    <ul>${criteriaHTML}</ul>
                </div>
                ${imageHTML}
                <div class="button-group">
                    <button class="btn btn-yes" onclick="handleAnswer('yes')">Yes</button>
                    <button class="btn btn-no" onclick="handleAnswer('no')">No</button>
                    <button class="btn btn-skip" onclick="handleAnswer('skip')">Skip</button>
                </div>
                <div class="navigation">
                    <button class="btn btn-back" onclick="goBack()" ${algo.currentStep === 1 ? 'style="visibility: hidden;"' : ''}>← Previous Step</button>
                    <button class="btn btn-back" onclick="resetAlgorithm()">Start Over</button>
                </div>
            `;
        }

        function handleAnswer(answer) {
            if (!currentAlgorithm) return;

            const algo = algorithms[currentAlgorithm];
            const step = algo.steps[algo.currentStep - 1];

            if (answer === 'skip') {
                skippedSteps.push(algo.currentStep);
            } else if (answer === 'yes') {
                yesAnswers.push(algo.currentStep);
            }

            // Always continue to next step until all steps are completed
            if (algo.currentStep < algo.totalSteps) {
                algo.currentStep++;
                loadStep();
            } else {
                // All steps completed, show final result
                showFinalResult();
            }
        }

        function showFinalResult() {
            const contentDiv = document.getElementById(currentAlgorithm + '-content');
            let resultClass, resultText, confidence;

            // Check if all steps were skipped
            if (skippedSteps.length === algorithms[currentAlgorithm].totalSteps) {
                resultClass = '';
                resultText = 'Inconclusive';
                confidence = 'All steps skipped - unable to determine diagnosis';
            } else if (yesAnswers.length > 0) {
                // Any "Yes" answer = VT
                resultClass = 'vt';
                resultText = 'Ventricular Tachycardia';
                confidence = 'High likelihood of ventricular tachycardia';
            } else {
                // No "Yes" answers
                if (currentAlgorithm === 'modified_brugada') {
                    resultClass = 'svt';
                    resultText = 'Supraventricular Tachycardia';
                    confidence = 'High likelihood of supraventricular tachycardia, pre-excited SVT possible';
                } else {
                    resultClass = 'svt';
                    resultText = 'Supraventricular Tachycardia';
                    confidence = 'High likelihood of supraventricular tachycardia';
                }
            }

            let skippedInfo = '';
            if (skippedSteps.length > 0) {
                skippedInfo = `<p style="margin-top: 15px; color: #2c3e50;">Note: Steps ${skippedSteps.join(', ')} were skipped</p>`;
            }

            let yesInfo = '';
            if (yesAnswers.length > 0) {
                yesInfo = `<p style="margin-top: 15px; color: #2c3e50;">Positive criteria found in step(s): ${yesAnswers.join(', ')}</p>`;
            }

            contentDiv.innerHTML = `
                <div class="result ${resultClass}">
                    <h2>${resultText}</h2>
                    <p>${confidence}</p>
                    ${yesInfo}
                    ${skippedInfo}
                </div>
                <div class="navigation" style="justify-content: center; margin-top: 30px;">
                    <button class="btn btn-back" onclick="resetAlgorithm()" style="margin-right: 15px;">Try Again</button>
                    <button class="btn btn-back" onclick="showAlgorithmSelection()">Choose Different Algorithm</button>
                </div>
            `;
        }

        function goBack() {
            if (!currentAlgorithm) return;
            
            const algo = algorithms[currentAlgorithm];
            if (algo.currentStep > 1) {
                algo.currentStep--;
                // Remove from skipped steps if going back
                const skipIndex = skippedSteps.indexOf(algo.currentStep);
                if (skipIndex > -1) {
                    skippedSteps.splice(skipIndex, 1);
                }
                
                // Remove from yes answers if going back
                const yesIndex = yesAnswers.indexOf(algo.currentStep);
                if (yesIndex > -1) {
                    yesAnswers.splice(yesIndex, 1);
                }
                loadStep();
            }
        }

        function resetAlgorithm() {
            if (!currentAlgorithm) return;
            
            algorithms[currentAlgorithm].currentStep = 1;
            skippedSteps = [];
            yesAnswers = []; // Reset yes answers tracking
            loadStep();
        }

        function showAlgorithmSelection() {
            // Hide all algorithm interfaces
            document.querySelectorAll('.algorithm-interface').forEach(el => {
                el.classList.remove('active');
            });

            // Remove selection from all cards
            document.querySelectorAll('.algorithm-card').forEach(el => {
                el.classList.remove('selected');
            });

            currentAlgorithm = null;
            skippedSteps = [];
            yesAnswers = []; // Reset yes answers tracking
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Application is ready
            console.log('VT Algorithm Navigator loaded successfully');
        });
    </script>
</body>
</html>
